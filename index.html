<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON DRIFT: FINAL PRO</title>
    <style>
        :root { --neon: #0ff; --bg: #050505; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        canvas { display: block; filter: contrast(1.2) saturate(1.2); }

        /* HUD */
        #hud { position: absolute; top: 0; width: 100%; display: flex; justify-content: space-between; padding: 20px; box-sizing: border-box; z-index: 10; pointer-events: none; }
        .stat-box { background: rgba(255, 255, 255, 0.05); padding: 5px 15px; border-radius: 20px; border: 1px solid rgba(0, 255, 255, 0.2); backdrop-filter: blur(5px); }
        .neon-text { color: var(--neon); text-shadow: 0 0 10px var(--neon); font-weight: bold; font-size: 20px; }

        /* Ghost Button */
        #ghost-btn {
            position: absolute; bottom: 30px; right: 20px; width: 75px; height: 75px;
            background: rgba(0, 255, 255, 0.1); border: 3px solid var(--neon);
            border-radius: 50%; color: var(--neon); font-weight: bold; font-size: 12px;
            display: none; align-items: center; justify-content: center;
            box-shadow: 0 0 20px var(--neon); cursor: pointer; z-index: 200;
            animation: pulse 1s infinite; pointer-events: auto;
        }
        @keyframes pulse { 0% { transform: scale(1.1); } 100% { transform: scale(1); } }

        #timer-box { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); font-size: 22px; color: #ff0; display: none; z-index: 20; font-weight: bold; }
        
        /* Overlay & Buttons */
        #overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 500; padding: 20px; text-align: center;
        }
        #pause-btn { 
            position: absolute; top: 15px; right: 15px; width: 45px; height: 45px; 
            border: 2px solid var(--neon); color: var(--neon); background: rgba(0,0,0,0.5); 
            border-radius: 50%; z-index: 1000; cursor: pointer; font-weight: bold;
        }

        .store-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .skin-card { background: #111; border: 2px solid #333; border-radius: 12px; padding: 10px; cursor: pointer; width: 75px; }
        .skin-card.active { border-color: var(--neon); box-shadow: 0 0 15px var(--neon); }
        .preview { width: 35px; height: 35px; border-radius: 50%; margin: 0 auto 5px; }

        .btn-main { background: var(--neon); color: #000; border: none; padding: 15px 45px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px var(--neon); text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="hud">
        <div class="stat-box">SCORE: <span id="s_val" class="neon-text">0</span></div>
        <div class="stat-box" style="border-color: #ffd700;">ORBS: <span id="o_val" style="color: #ffd700;">0</span></div>
    </div>

    <div id="timer-box">POWER ACTIVE</div>
    <button id="pause-btn" onclick="togglePause()">II</button>
    <div id="ghost-btn" onclick="activateGhost()">GHOST</div>

    <div id="overlay">
        <h1 id="m_title" style="color: var(--neon); text-shadow: 0 0 20px var(--neon); margin: 0; font-size: 2.5rem;">NEON DRIFT</h1>
        <p id="m_desc" style="color:#888; font-size: 14px; margin: 10px 0;">GHOST CHARGE AT 2000 SCORE</p>
        
        <div class="store-grid">
            <div class="skin-card active" onclick="setSkin('#0ff', 0, this, 'solid')"> <div class="preview" style="background:#0ff;"></div> <span>FREE</span> </div>
            <div class="skin-card" onclick="setSkin('#f0f', 50, this, 'ring')"> <div class="preview" style="border:3px double #f0f;"></div> <span>50</span> </div>
            <div class="skin-card" onclick="setSkin('#0f0', 100, this, 'glow')"> <div class="preview" style="background:radial-gradient(#fff,#0f0);"></div> <span>100</span> </div>
            <div class="skin-card" onclick="setSkin('#ff0', 250, this, 'plasma')"> <div class="preview" style="background:repeating-conic-gradient(#ff0 0% 25%,#111 0% 50%);"></div> <span>250</span> </div>
            <div class="skin-card" onclick="setSkin('#fff', 500, this, 'star')"> <div class="preview" style="background:#fff;clip-path:polygon(50% 0%,61% 35%,98% 35%,68% 57%,79% 91%,50% 70%,21% 91%,32% 57%,2% 35%,39% 35%);"></div> <span>500</span> </div>
            <div class="skin-card" onclick="setSkin('#f33', 1000, this, 'ultra')"> <div class="preview" style="background:#f33;border:2px dashed #fff;"></div> <span>1000</span> </div>
        </div>
        <button id="p_btn" class="btn-main" onclick="init()">START GAME</button>
    </div>

    <canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const g = canvas.getContext('2d');
const overlay = document.getElementById('overlay');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0, orbs = parseInt(localStorage.getItem('saved_orbs')) || 0;
let level = 1, active = false, paused = false, frame = 0, flash = 0;
let skinColor = '#0ff', skinType = 'solid';
let objs = [], floatTexts = [];

let ghostCharges = 0, ghostActive = false, ghostTime = 0;
let boosterActive = false, boosterTime = 0;
let nextGhostMilestone = 2000;

const player = { x: canvas.width/2, y: canvas.height * 0.8, r: 16, tx: canvas.width/2, alpha: 1 };

// --- SOUNDS ---
const bgm = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3');
const sfxCollect = new Audio('https://assets.mixkit.co/active_storage/sfx/2019/collect-sci-fi-game-item-1224.wav');
const sfxGhost = new Audio('https://assets.mixkit.co/active_storage/sfx/1103/1103-preview.mp3');
const sfxBoost = new Audio('https://assets.mixkit.co/active_storage/sfx/600/600-preview.mp3');
const sfxCrash = new Audio('https://assets.mixkit.co/active_storage/sfx/250/250-preview.mp3');
bgm.loop = true;

function setSkin(color, cost, el, type) {
    if(orbs >= cost) {
        skinColor = color; skinType = type;
        document.querySelectorAll('.skin-card').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        document.documentElement.style.setProperty('--neon', color);
    }
}

function init() {
    if(paused) { togglePause(); return; }
    score = 0; level = 1; objs = []; active = true; paused = false;
    ghostCharges = 0; ghostActive = false; boosterActive = false;
    nextGhostMilestone = 2000; overlay.style.display = 'none';
    document.getElementById('ghost-btn').style.display = 'none';
    document.getElementById('timer-box').style.display = 'none';
    bgm.currentTime = 0; bgm.play().catch(()=>{});
    update();
}

function togglePause() {
    if(!active) return;
    paused = !paused;
    if(paused) {
        overlay.style.display = 'flex';
        document.getElementById('m_title').innerText = "PAUSED";
        document.getElementById('p_btn').innerText = "RESUME";
        bgm.pause();
    } else {
        overlay.style.display = 'none';
        bgm.play().catch(()=>{});
        update();
    }
}

function activateGhost() {
    if(ghostCharges > 0 && !ghostActive) {
        ghostCharges--; ghostActive = true; ghostTime = 360; flash = 15;
        sfxGhost.currentTime = 0; sfxGhost.play().catch(()=>{});
        document.getElementById('ghost-btn').style.display = ghostCharges > 0 ? 'flex' : 'none';
        document.getElementById('timer-box').innerText = "GHOST MODE ON";
        document.getElementById('timer-box').style.display = 'block';
    }
}

window.addEventListener('touchmove', e => { if(active && !paused) player.tx = e.touches[0].clientX; });

function drawPlayerShape() {
    g.save(); g.translate(player.x, player.y);
    g.globalAlpha = player.alpha;
    g.shadowBlur = ghostActive ? 30 : 15; g.shadowColor = boosterActive ? "#0af" : skinColor;
    g.strokeStyle = skinColor; g.lineWidth = 3;

    if(skinType === 'solid') {
        g.fillStyle = "#fff"; g.beginPath(); g.arc(0, 0, player.r, 0, Math.PI*2); g.fill(); g.stroke();
    } else if(skinType === 'ring') {
        g.beginPath(); g.arc(0, 0, player.r, 0, Math.PI*2); g.stroke();
        g.beginPath(); g.arc(0, 0, player.r-7, 0, Math.PI*2); g.stroke();
    } else if(skinType === 'glow') {
        let grad = g.createRadialGradient(0,0,0,0,0,player.r); grad.addColorStop(0, '#fff'); grad.addColorStop(1, skinColor);
        g.fillStyle = grad; g.beginPath(); g.arc(0,0, player.r, 0, Math.PI*2); g.fill();
    } else if(skinType === 'plasma') {
        g.rotate(frame*0.08); g.strokeRect(-12,-12,24,24); g.strokeRect(-7,-7,14,14);
    } else if(skinType === 'star') {
        let rot=Math.PI/2*3, step=Math.PI/5; g.beginPath(); g.moveTo(0, -16);
        for(let i=0;i<5;i++){ g.lineTo(Math.cos(rot)*16, Math.sin(rot)*16); rot+=step; g.lineTo(Math.cos(rot)*8, Math.sin(rot)*8); rot+=step; }
        g.closePath(); g.fillStyle="#fff"; g.fill(); g.stroke();
    } else if(skinType === 'ultra') {
        g.fillStyle="#fff"; g.beginPath(); g.arc(0,0, player.r, 0, Math.PI*2); g.fill(); g.setLineDash([4,2]); g.stroke();
    }
    g.restore();
}

function update() {
    if(!active || paused) return;
    frame++;
    player.x += (player.tx - player.x) * 0.18;

    if(score >= nextGhostMilestone) {
        ghostCharges++; nextGhostMilestone += 2000;
        document.getElementById('ghost-btn').style.display = 'flex';
    }

    if(ghostActive) {
        ghostTime--; if(ghostTime <= 0) { ghostActive = false; document.getElementById('timer-box').style.display = 'none'; player.alpha = 1; }
        else player.alpha = 0.5 + Math.sin(frame*0.2)*0.2;
    }

    if(boosterActive) {
        boosterTime--; if(boosterTime <= 0) { boosterActive = false; document.getElementById('timer-box').style.display = 'none'; }
    }

    // Spawn Timing
    let rate = boosterActive ? 15 : Math.max(8, 25 - level);
    if(frame % rate === 0) {
        objs.push({t:'obs', x:Math.random()*canvas.width, y:-50, w:95+(level*4), h:20, s:(5+level*0.4)*(boosterActive?2.2:1)});
    }
    if(frame % 150 === 0) objs.push({t:'orb', x:Math.random()*canvas.width, y:-50, r:10, s:4.5, c:'#ffd700'});
    
    // BLUE BOOSTER - RARE SPAWN (Every ~12 seconds at 60fps)
    if(frame % 750 === 0) objs.push({t:'boost', x:Math.random()*canvas.width, y:-50, r:14, s:6, c:'#0af'});

    if(score > level * 1000) level++;
    draw();
    requestAnimationFrame(update);
}

function draw() {
    g.fillStyle = 'rgba(5,5,5,0.3)'; g.fillRect(0,0,canvas.width, canvas.height);
    if(flash > 0) { g.fillStyle=`rgba(255,255,255,${flash/15})`; g.fillRect(0,0,canvas.width, canvas.height); flash--; }

    drawPlayerShape();

    objs.forEach((o, i) => {
        o.y += o.s;
        if(o.t === 'obs') {
            g.fillStyle = ghostActive ? '#333' : '#f33'; g.fillRect(o.x - o.w/2, o.y, o.w, o.h);
            if(Math.abs(player.x - o.x) < o.w/2 + 10 && Math.abs(player.y - o.y) < 20 && !ghostActive) {
                active = false; bgm.pause(); sfxCrash.play(); 
                document.getElementById('m_title').innerText = "GAME OVER";
                document.getElementById('p_btn').innerText = "RESTART";
                overlay.style.display='flex';
            }
        } else {
            g.fillStyle = o.c; g.shadowBlur = 15; g.shadowColor = o.c;
            g.beginPath(); g.arc(o.x, o.y, o.r, 0, Math.PI*2); g.fill();
            if(Math.hypot(player.x - o.x, player.y - o.y) < 30) {
                objs.splice(i, 1);
                if(o.t === 'orb') { score += 100; orbs += 5; sfxCollect.currentTime = 0; sfxCollect.play(); }
                else { 
                    boosterActive = true; boosterTime = 180; flash = 15; 
                    sfxBoost.currentTime = 0; sfxBoost.play(); // BLUE SOUND BACK
                    objs = objs.filter(obj => obj.t !== 'obs');
                    document.getElementById('timer-box').innerText = "HYPER DRIVE";
                    document.getElementById('timer-box').style.display = 'block';
                }
                localStorage.setItem('saved_orbs', orbs); document.getElementById('o_val').innerText = orbs;
            }
        }
        if(o.y > canvas.height) { objs.splice(i, 1); score += 5; }
    });
    
    if(frame % 3 === 0) score += boosterActive ? 5 : 1; 
    document.getElementById('s_val').innerText = score;
}
</script>
</body>
</html>
